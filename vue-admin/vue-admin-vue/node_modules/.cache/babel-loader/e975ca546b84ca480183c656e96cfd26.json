{"remainingRequest":"D:\\software_ware\\workspace_idea\\grower\\vue-admin\\vue-admin-vue\\node_modules\\babel-loader\\lib\\index.js!D:\\software_ware\\workspace_idea\\grower\\vue-admin\\vue-admin-vue\\src\\utils\\guard.js","dependencies":[{"path":"D:\\software_ware\\workspace_idea\\grower\\vue-admin\\vue-admin-vue\\src\\utils\\guard.js","mtime":1648710825798},{"path":"D:\\software_ware\\workspace_idea\\grower\\vue-admin\\vue-admin-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1620148001861},{"path":"D:\\software_ware\\workspace_idea\\grower\\vue-admin\\vue-admin-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1620148001577}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7Ci8vID8g5YaF5a6577ya5YWo5bGA5YmN572u5a6I5Y2r77yI6Lev55Sx6KeE5YiZ77yJ77yM5qC55o2u44CQ55So5oi35p2D6ZmQ44CR5Yqo5oCB6I635Y+W44CQ6I+c5Y2V5YiX6KGo44CRCmltcG9ydCBheGlvcyBmcm9tICdAL3V0aWxzL2F4aW9zJzsKaW1wb3J0IHN0b3JlIGZyb20gJ0Avc3RvcmUnOwppbXBvcnQgcm91dGVyIGZyb20gJ0Avcm91dGVyJzsgLy8g5YWo5bGA5YmN572u5a6I5Y2rCgpyb3V0ZXIuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICB2YXIgaGFzUm91dGUgPSBzdG9yZS5zdGF0ZS5tZW51cy5oYXNSb3V0ZXM7CiAgdmFyIHRva2VuID0gc3RvcmUuc3RhdGUudG9rZW47IC8vIOiuv+mXri9sb2dpbu+8jOebtOaOpeiuv+mXrgoKICBpZiAodG8ucGF0aCA9PSAnL2xvZ2luJykgewogICAgbmV4dCgpOwogIH0gZWxzZSB7CiAgICAvLyDmnKrnmbvlvZXnirbmgIHvvIzov5Tlm54KICAgIGlmICh0eXBlb2YgdG9rZW4gPT09ICd1bmRlZmluZWQnIHx8IHRva2VuID09PSBudWxsIHx8IHRva2VuID09PSAnJykgewogICAgICBuZXh0KHsKICAgICAgICBwYXRoOiAnL2xvZ2luJwogICAgICB9KTsKICAgIH0gLy8g5Yi35paw6aG16Z2i5pe277yMaGFzUm91dGUg5Y+Y6YeP5oGi5aSN5Li6IGZhbHNl77yM5Y2z5LiN6LCD55SoIGluaXRNZW5177yb54K55Ye75p+Q5Liq6L+e5o6l5pe277yMaGFzUm91dGUg5Y+Y6YeP5LuN5Li6IHRydWXvvIzljbPosIPnlKggaW5pdE1lbnUKCgogICAgaWYgKHRva2VuICYmICFoYXNSb3V0ZSkgewogICAgICBpbml0TWVudShyb3V0ZXIsIHN0b3JlKTsKICAgICAgc3RvcmUuY29tbWl0KCdTRVRfSEFTX1JPVVRFUycsIHRydWUpOwogICAgICBuZXh0KCk7CiAgICB9IC8vIOiuv+mXriDpnZ4vbG9naW7vvIzkuJQg5oul5pyJIHRva2Vu77yM55u05o6l6K6/6ZeuCgoKICAgIGlmICh0b2tlbiAmJiB0by5wYXRoICE9ICcvbG9naW4nKSB7CiAgICAgIG5leHQoKTsKICAgIH0KICB9Cn0pOyAvLyDliJ3lp4vjgJDot6/nlLHliJfooajjgJEKCnZhciBpbml0TWVudSA9IGZ1bmN0aW9uIGluaXRNZW51KHJvdXRlciwgc3RvcmUpIHsKICBpZiAoc3RvcmUuc3RhdGUubWVudXMubWVudUxpc3QubGVuZ3RoID4gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICBheGlvcy5nZXQoJy9zeXMvbWVudS9uYXYnLCB7CiAgICBoZWFkZXJzOiB7CiAgICAgIGF1dGhvcml6YXRpb246IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpCiAgICB9CiAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICBpZiAocmVzKSB7CiAgICAgIC8vIOiOt+WPluOAkOiPnOWNleWIl+ihqOOAkQogICAgICBzdG9yZS5jb21taXQoJ1NFVF9NRU5VX0xJU1QnLCByZXMuZGF0YS5kYXRhLm5hdik7IC8vIOiOt+WPluOAkOadg+mZkOWIl+ihqOOAkQoKICAgICAgc3RvcmUuY29tbWl0KCdTRVRfUEVSX0xJU1QnLCByZXMuZGF0YS5kYXRhLmF1dGhvcml0eXMpOyAvLyDnu5HlrprjgJDliqjmgIHot6/nlLHjgJEKCiAgICAgIGZvcm1hdFJvdXRlcyhyZXMpOwogICAgfQogIH0pOwp9OyAvLyDnu5HlrprjgJDliqjmgIHot6/nlLHjgJEKCgp2YXIgZm9ybWF0Um91dGVzID0gZnVuY3Rpb24gZm9ybWF0Um91dGVzKHJlcykgewogIC8vIDEu6I635Y+W5b2T5YmN6Lev55Sx5YiX6KGoCiAgdmFyIG5vd1JvdXRlcyA9IHJvdXRlci5vcHRpb25zLnJvdXRlczsgLy8gMi7pgY3ljobjgJByZXMuZGF0YS5kYXRhLm5hduOAke+8jOW5tuS+neasoeWwhuWFtuWKoOWFpei3r+eUseWIl+ihqAoKICByZXMuZGF0YS5kYXRhLm5hdi5mb3JFYWNoKGZ1bmN0aW9uIChtZW51KSB7CiAgICBpZiAobWVudS5jaGlsZHJlbikgewogICAgICBtZW51LmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAvLyDjgJDlpITnkIbvvJrmoLzlvI/ljJbot6/nlLHjgJEKICAgICAgICB2YXIgcm91dGUgPSBtZW51VG9Sb3V0ZShlKTsgLy8g5oqK44CQ5paw6Lev55Sx44CR5re75Yqg5Yiw44CQ5pen6Lev55Sx5pWw57uE44CR5LitCgogICAgICAgIGlmIChyb3V0ZSkgewogICAgICAgICAgbm93Um91dGVzWzFdLmNoaWxkcmVuLnB1c2gocm91dGUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CiAgcm91dGVyLmFkZFJvdXRlcyhub3dSb3V0ZXMpOwp9OyAvLyDlpITnkIbjgJDmoLzlvI/ljJbot6/nlLHjgJEKCgp2YXIgbWVudVRvUm91dGUgPSBmdW5jdGlvbiBtZW51VG9Sb3V0ZShtZW51KSB7CiAgaWYgKG1lbnUuY29tcG9uZW50KSB7CiAgICB2YXIgcm91dGUgPSB7CiAgICAgIHBhdGg6IG1lbnUucGF0aCwKICAgICAgbmFtZTogbWVudS5uYW1lLAogICAgICBjb21wb25lbnQ6IGZ1bmN0aW9uIGNvbXBvbmVudCgpIHsKICAgICAgICByZXR1cm4gaW1wb3J0KCdAL3ZpZXdzLycgKyBtZW51LmNvbXBvbmVudCArICcudnVlJyk7CiAgICAgIH0sCiAgICAgIG1ldGE6IHsKICAgICAgICBpY29uOiBtZW51Lmljb24sCiAgICAgICAgdGl0bGU6IG1lbnUudGl0bGUKICAgICAgfQogICAgfTsKICAgIHJldHVybiByb3V0ZTsKICB9CgogIHJldHVybiBudWxsOwp9OwoKZXhwb3J0IGRlZmF1bHQgcm91dGVyOw=="},{"version":3,"sources":["D:/software_ware/workspace_idea/grower/vue-admin/vue-admin-vue/src/utils/guard.js"],"names":["axios","store","router","beforeEach","to","from","next","hasRoute","state","menus","hasRoutes","token","path","initMenu","commit","menuList","length","get","headers","authorization","localStorage","getItem","then","res","data","nav","authoritys","formatRoutes","nowRoutes","options","routes","forEach","menu","children","e","route","menuToRoute","push","addRoutes","component","name","meta","icon","title"],"mappings":"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","sourcesContent":["// ? 内容：全局前置守卫（路由规则），根据【用户权限】动态获取【菜单列表】\n\nimport axios from '@/utils/axios'\nimport store from '@/store'\nimport router from '@/router'\n\n// 全局前置守卫\nrouter.beforeEach((to, from, next) => {\n  let hasRoute = store.state.menus.hasRoutes\n  let token = store.state.token\n\n  // 访问/login，直接访问\n  if (to.path == '/login') {\n    next()\n  } else {\n    // 未登录状态，返回\n    if (typeof token === 'undefined' || token === null || token === '') {\n      next({ path: '/login' })\n    }\n\n    // 刷新页面时，hasRoute 变量恢复为 false，即不调用 initMenu；点击某个连接时，hasRoute 变量仍为 true，即调用 initMenu\n    if (token && !hasRoute) {\n      initMenu(router, store)\n      store.commit('SET_HAS_ROUTES', true)\n      next()\n    }\n\n    // 访问 非/login，且 拥有 token，直接访问\n    if (token && to.path != '/login') {\n      next()\n    }\n  }\n})\n\n// 初始【路由列表】\nconst initMenu = (router, store) => {\n  if (store.state.menus.menuList.length > 0) {\n    return null\n  }\n  axios\n    .get('/sys/menu/nav', {\n      headers: { authorization: localStorage.getItem('token') },\n    })\n    .then((res) => {\n      if (res) {\n        // 获取【菜单列表】\n        store.commit('SET_MENU_LIST', res.data.data.nav)\n        // 获取【权限列表】\n        store.commit('SET_PER_LIST', res.data.data.authoritys)\n        // 绑定【动态路由】\n        formatRoutes(res)\n      }\n    })\n}\n\n// 绑定【动态路由】\nconst formatRoutes = (res) => {\n  // 1.获取当前路由列表\n  let nowRoutes = router.options.routes\n  // 2.遍历【res.data.data.nav】，并依次将其加入路由列表\n  res.data.data.nav.forEach((menu) => {\n    if (menu.children) {\n      menu.children.forEach((e) => {\n        // 【处理：格式化路由】\n        let route = menuToRoute(e)\n        // 把【新路由】添加到【旧路由数组】中\n        if (route) {\n          nowRoutes[1].children.push(route)\n        }\n      })\n    }\n  })\n  router.addRoutes(nowRoutes)\n}\n\n// 处理【格式化路由】\nconst menuToRoute = (menu) => {\n  if (menu.component) {\n    let route = {\n      path: menu.path,\n      name: menu.name,\n      component: () => import('@/views/' + menu.component + '.vue'),\n      meta: {\n        icon: menu.icon,\n        title: menu.title,\n      },\n    }\n    return route\n  }\n  return null\n}\n\nexport default router\n"]}]}